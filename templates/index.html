{% extends '__layout.html' %}

{% macro client(cl) %}
    {% if cl.type != 0 %}
        <i class="glyphicon glyphicon-eye-close"></i>
    {% elif cl.afk %}
        <i class="glyphicon glyphicon-volume-off"></i>
    {% else %}
        <i class="glyphicon glyphicon-user"></i>
    {% endif %}

    {{ cl.name }}
{% endmacro %}

{% macro channel(c) %}
    <a class="list-group-item">
        <i class="glyphicon glyphicon-chevron-right"></i>
        <strong>{{ c.name }}</strong>
    </a>

    <div class="list-group" id="channel-{{ c.id }}">
        {% for sc in c.subchannels %}
            <div class="list-group-item">{{ channel(sc) }}</div>
        {% endfor %}

        {% for cl in c.clients %}
            <div class="list-group-item">{{ client(cl) }}</div>
        {% endfor %}
    </div>
{% endmacro %}

{% block body %}
    <h4>Used channels:</h4>

    <div style="max-width: 450px;">
        <div class="list-group list-group-root well">
            {% for ch in server.channels %}
                {{ channel(ch) }}
            {% endfor %}
        </div>

        <div>Server state at: {{ fetch_time }}</div>
    </div>

    <script>
        $(function () {
            $('.list-group-item').on('click', function () {
                $('.glyphicon', this)
                    .toggleClass('glyphicon-chevron-right')
                    .toggleClass('glyphicon-chevron-down');
            });
        });
    </script>
{% endblock %}